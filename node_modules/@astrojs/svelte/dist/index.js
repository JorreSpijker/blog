var __defProp = Object.defineProperty;
var __defProps = Object.defineProperties;
var __getOwnPropDescs = Object.getOwnPropertyDescriptors;
var __getOwnPropSymbols = Object.getOwnPropertySymbols;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __propIsEnum = Object.prototype.propertyIsEnumerable;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __spreadValues = (a, b) => {
  for (var prop in b || (b = {}))
    if (__hasOwnProp.call(b, prop))
      __defNormalProp(a, prop, b[prop]);
  if (__getOwnPropSymbols)
    for (var prop of __getOwnPropSymbols(b)) {
      if (__propIsEnum.call(b, prop))
        __defNormalProp(a, prop, b[prop]);
    }
  return a;
};
var __spreadProps = (a, b) => __defProps(a, __getOwnPropDescs(b));
import { svelte } from "@sveltejs/vite-plugin-svelte";
import preprocess from "svelte-preprocess";
function getRenderer() {
  return {
    name: "@astrojs/svelte",
    clientEntrypoint: "@astrojs/svelte/client.js",
    serverEntrypoint: "@astrojs/svelte/server.js"
  };
}
function getViteConfiguration({
  options,
  postcssConfig,
  isDev
}) {
  const defaultOptions = {
    emitCss: true,
    compilerOptions: { dev: isDev, hydratable: true },
    preprocess: [
      preprocess({
        less: true,
        postcss: postcssConfig,
        sass: { renderSync: true },
        scss: { renderSync: true },
        stylus: true,
        typescript: true
      })
    ]
  };
  let resolvedOptions;
  if (!options) {
    resolvedOptions = defaultOptions;
  } else if (typeof options === "function") {
    resolvedOptions = options(defaultOptions);
  } else {
    resolvedOptions = __spreadProps(__spreadValues(__spreadValues({}, options), defaultOptions), {
      compilerOptions: __spreadValues(__spreadValues({}, options.compilerOptions), defaultOptions.compilerOptions),
      preprocess: options.preprocess ?? defaultOptions.preprocess
    });
  }
  return {
    optimizeDeps: {
      include: ["@astrojs/svelte/client.js", "svelte", "svelte/internal"],
      exclude: ["@astrojs/svelte/server.js"]
    },
    plugins: [svelte(resolvedOptions)]
  };
}
function src_default(options) {
  return {
    name: "@astrojs/svelte",
    hooks: {
      "astro:config:setup": ({ command, updateConfig, addRenderer, config }) => {
        addRenderer(getRenderer());
        updateConfig({
          vite: getViteConfiguration({
            options,
            isDev: command === "dev",
            postcssConfig: config.style.postcss
          })
        });
      }
    }
  };
}
export {
  src_default as default
};
